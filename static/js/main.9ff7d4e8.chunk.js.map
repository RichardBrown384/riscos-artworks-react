{"version":3,"sources":["App.js","components/OutlineComponent.js","components/ShadedComponent.js","components/D3TreeComponent.js","components/JsonTreeComponent.js","index.js"],"names":["App","useState","buffer","setBuffer","event","a","target","files","file","arrayBuffer","array","Buffer","from","type","onChange","convertPaths","paths","strokeWidth","toPathString","path","result","element","tag","points","push","flatMap","x","y","join","map","index","d","fill","stroke","extractOutlines","records","fileBoundingBox","processPath","other","safe","operation","b","minX","maxX","minY","maxY","isBoundingBoxValid","Math","min","max","mergeBoundingBox","boundingBox","traverse","children","data","RECORD_PATH","RECORD_2C","RECORD_34","RECORD_35","RECORD_38","RECORD_3D","OutlineComponent","artworks","Artworks","load","error","message","width","height","screenHeight","sx","sy","transform","pointer","pathData","key","JSON","stringify","convertDefs","CustomTag","defs","stops","stop","convertStops","extractShaded","palette","linearGradients","radialGradients","renderState","fillRule","strokeLinecap","getColour","colours","length","colour","fillType","FILL_FLAT","FILL_LINEAR","gradientLine","startColour","endColour","id","p1","p2","gradient","gradientUnits","x1","y1","x2","y2","offset","stopColor","linearGradient","FILL_RADIAL","dx","dy","r","sqrt","cx","cy","fx","fy","radialGradient","processLineCap","capStyle","reverse","traverseInner","RECORD_STROKE_COLOUR","strokeColour","processStrokeColour","RECORD_STROKE_WIDTH","processStrokeWidth","RECORD_FILL_COLOUR","processFillColour","RECORD_LINE_CAP_START","RECORD_LINE_CAP_END","ShadedComponent","FILLS","name","RECORD_GROUP","RECORD_LAYER","RECORD_CHARACTER","toString","nameInner","D3TreeComponent","props","ref","React","createRef","this","buildTree","hierarchy","d3","root","nodeSize","x0","Infinity","each","current","innerHTML","g","append","attr","node","selectAll","links","descendants","text","clone","lower","Component","JsonTreeComponent","myArrayBuffer","Promise","resolve","fr","FileReader","onload","readAsArrayBuffer","File","prototype","Blob","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9ff7d4e8.chunk.js","sourcesContent":["import {useState} from 'react';\nimport OutlineComponent from './components/OutlineComponent';\nimport ShadedComponent from './components/ShadedComponent';\nimport D3TreeComponent from './components/D3TreeComponent';\nimport JsonTreeComponent from './components/JsonTreeComponent';\n\nfunction App() {\n    const [buffer, setBuffer] = useState(null);\n    async function loadFile(event) {\n        const { target: { files = [] }} = event;\n        const [file,] = files;\n        if (file) {\n            try {\n                const array = await file.arrayBuffer();\n                setBuffer(Buffer.from(array));\n            } catch (e) {\n                setBuffer(null);\n            }\n        } else {\n            setBuffer(null);\n        }\n    }\n    return (\n        <div>\n            <h1>RISC OS Artworks Viewer</h1>\n            <input type=\"file\" onChange={loadFile} />\n            <OutlineComponent buffer={buffer} />\n            <ShadedComponent buffer={buffer} />\n            <JsonTreeComponent buffer={buffer} />\n            <D3TreeComponent buffer={buffer}/>\n        </div>\n    );\n}\n\nexport default App;\n","import {\n    Artworks,\n    RECORD_PATH,\n    RECORD_2C,\n    RECORD_34,\n    RECORD_35,\n    RECORD_38,\n    RECORD_3D\n} from 'riscos-artworks';\n\nfunction convertPaths(paths, strokeWidth) {\n\n    function toPathString(path) {\n        const result = [];\n        for (const element of path) {\n            const {tag, points = []} = element;\n            result.push(`${tag} ${points.flatMap(({x, y}) => [x, y])}`);\n        }\n        return result.join(' ');\n    }\n\n    return paths.map((path, index) => {\n        return <path d={toPathString(path)}\n                     fill=\"none\"\n                     stroke=\"black\"\n                     strokeWidth={strokeWidth}\n                     key={index}/>;\n    });\n}\n\n\nfunction extractOutlines({records = []}) {\n\n    const paths = [];\n    const fileBoundingBox = {}\n\n    function isBoundingBoxValid({minX, maxX, minY, maxY}) {\n        return (minX < maxX) && (minY < maxY);\n    }\n\n    function mergeBoundingBox(other) {\n        if (!isBoundingBoxValid(other)) {\n            return;\n        }\n\n        function safe(operation, a, b) {\n            return !a ? b : operation(a, b);\n        }\n\n        fileBoundingBox.minX = safe(Math.min, fileBoundingBox.minX, other.minX);\n        fileBoundingBox.maxX = safe(Math.max, fileBoundingBox.maxX, other.maxX);\n        fileBoundingBox.minY = safe(Math.min, fileBoundingBox.minY, other.minY);\n        fileBoundingBox.maxY = safe(Math.max, fileBoundingBox.maxY, other.maxY);\n    }\n\n    function processPath({path, boundingBox}) {\n        mergeBoundingBox(boundingBox);\n        paths.push(path);\n    }\n\n    function traverse({children = [], ...data}) {\n        const {type} = data;\n        switch (type & 0xFF) {\n            case RECORD_PATH:\n                processPath(data);\n                break;\n            case RECORD_2C:\n                processPath(data);\n                break;\n            case RECORD_34:\n                processPath(data);\n                break;\n            case RECORD_35:\n                processPath(data);\n                break;\n            case RECORD_38:\n                processPath(data);\n                break;\n            case RECORD_3D:\n                processPath(data);\n                break;\n            default:\n                break;\n        }\n        for (const child of children) {\n            traverse(child);\n        }\n    }\n\n    for (const record of records) {\n        traverse(record);\n    }\n\n    return {boundingBox: fileBoundingBox, paths};\n}\n\nfunction OutlineComponent({buffer}) {\n    if (!buffer) {\n        return <div/>;\n    }\n\n    const artworks = Artworks.load(buffer);\n    const {error} = artworks;\n    if (error) {\n        return (\n            <div>\n                <div>\n                    A problem occurred loading the file: {error.message}\n                </div>\n            </div>\n        );\n    }\n\n    const {\n        boundingBox: {minX, maxX, minY, maxY},\n        paths\n    } = extractOutlines(artworks);\n\n    const width = Math.max(maxX - minX, 1);\n    const height = Math.max(maxY - minY, 1);\n\n    const screenWidth = 800;\n    const screenHeight = (height * screenWidth) / width;\n\n    const sx = screenWidth / width;\n    const sy = screenHeight / height;\n\n    const transform = [sx, 0, 0, -sy, -sx * minX, sy * maxY];\n\n    return (\n        <div>\n            <svg width={screenWidth} height={screenHeight}>\n                <g transform={`matrix(${transform})`}>\n                    {convertPaths(paths, 160)}\n                </g>\n            </svg>\n        </div>\n    );\n}\n\nexport default OutlineComponent;","// TODO support start and end line caps with svg markers\n// https://stackoverflow.com/questions/11808860/how-to-place-arrow-head-triangles-on-svg-lines\n\n// TODO colour transitions between shapes\n// https://graphicdesign.stackexchange.com/questions/127669/is-it-possible-to-do-smooth-color-transition-between-2-paths-in-inkscape\n\nimport {\n    Artworks,\n    FILL_FLAT,\n    FILL_LINEAR,\n    FILL_RADIAL,\n    RECORD_2C,\n    RECORD_34,\n    RECORD_35,\n    RECORD_38,\n    RECORD_3D,\n    RECORD_FILL_COLOUR,\n    RECORD_LINE_CAP_END,\n    RECORD_LINE_CAP_START,\n    RECORD_PATH,\n    RECORD_STROKE_COLOUR,\n    RECORD_STROKE_WIDTH\n} from 'riscos-artworks';\n\nfunction convertPaths(paths) {\n    return paths.map((path, index) => {\n        const {pointer, ...pathData} = path;\n        return <path {...pathData} key={index}>\n            <desc>{JSON.stringify(pointer)}</desc>\n        </path>;\n    });\n}\n\nfunction convertStops(stops) {\n    return stops.map((stop, index) => {\n        return <stop {...stop} key={index}/>\n    });\n}\n\nfunction convertDefs(CustomTag, defs) {\n    return defs.map(({stops, ...data}, index) => {\n        return <CustomTag {...data} key={index}>\n            {convertStops(stops)}\n        </CustomTag>\n    });\n}\n\n\nfunction extractShaded({records = [], palette = {}}) {\n\n    const linearGradients = [];\n    const radialGradients = [];\n    const paths = [];\n    const fileBoundingBox = {}\n\n    const renderState = {\n        fill: 'none',\n        fillRule: 'nonzero',\n        stroke: 'black',\n        strokeWidth: 160,\n        strokeLinecap: 'butt'\n    };\n\n    function isBoundingBoxValid({minX, maxX, minY, maxY}) {\n        return (minX < maxX) && (minY < maxY);\n    }\n\n    function mergeBoundingBox(other) {\n        if (!isBoundingBoxValid(other)) {\n            return;\n        }\n\n        function safe(operation, a, b) {\n            return !a ? b : operation(a, b);\n        }\n\n        fileBoundingBox.minX = safe(Math.min, fileBoundingBox.minX, other.minX);\n        fileBoundingBox.maxX = safe(Math.max, fileBoundingBox.maxX, other.maxX);\n        fileBoundingBox.minY = safe(Math.min, fileBoundingBox.minY, other.minY);\n        fileBoundingBox.maxY = safe(Math.max, fileBoundingBox.maxY, other.maxY);\n    }\n\n    function getColour(index) {\n        const {colours = []} = palette;\n        if (index < colours.length) {\n            const {colour = 0xFF00FF} = colours[index];\n            const b = (colour >> 16) & 0xFF;\n            const g = (colour >> 8) & 0xFF;\n            const r = (colour) & 0xFF;\n            return `rgb(${[r, g, b]})`\n        }\n        return 'none';\n    }\n\n    function toPathString(path) {\n        const result = [];\n        for (const element of path) {\n            const {tag, points = []} = element;\n            result.push(`${tag} ${points.flatMap(({x, y}) => [x, y])}`);\n        }\n        return result.join(' ');\n    }\n\n    function flatFill({colour}) {\n        return getColour(colour);\n    }\n\n    function linearGradient({gradientLine, startColour, endColour}) {\n        const id = `linear-gradient-${linearGradients.length}`;\n        const [p1, p2] = gradientLine;\n        const gradient = {\n            id,\n            gradientUnits: 'userSpaceOnUse',\n            x1: p1.x,\n            y1: p1.y,\n            x2: p2.x,\n            y2: p2.y,\n            stops: [\n                {offset: \"0%\", stopColor: getColour(startColour)},\n                {offset: \"100%\", stopColor: getColour(endColour)},\n            ]\n        };\n        linearGradients.push(gradient);\n        return `url(#${id})`;\n    }\n\n    function radialGradient({gradientLine, startColour, endColour}) {\n        const id = `radial-gradient-${radialGradients.length}`;\n        const [p1, p2] = gradientLine;\n        const dx = p2.x - p1.x;\n        const dy = p2.y - p1.y;\n        const r = Math.sqrt(dx * dx + dy * dy);\n        const gradient = {\n            id,\n            gradientUnits: 'userSpaceOnUse',\n            cx: p1.x,\n            cy: p1.y,\n            fx: p1.x,\n            fy: p1.y,\n            r,\n            stops: [\n                {offset: \"0%\", stopColor: getColour(startColour)},\n                {offset: \"100%\", stopColor: getColour(endColour)},\n            ]\n        };\n        radialGradients.push(gradient);\n        return `url(#${id})`;\n    }\n\n    function fill({fillType, ...data}) {\n        switch (fillType) {\n            case FILL_FLAT:\n                return flatFill(data);\n            case FILL_LINEAR:\n                return linearGradient(data);\n            case FILL_RADIAL:\n                return radialGradient(data);\n            default:\n                return 'none';\n        }\n    }\n\n    function processPath({pointer, path, boundingBox}) {\n        mergeBoundingBox(boundingBox);\n        paths.push({\n            d: toPathString(path),\n            ...renderState,\n            pointer\n        });\n        // TODO Hack forcibly reset the render state\n        renderState.fill = 'none';\n        renderState.stroke = 'black';\n        renderState.strokeWidth = 160;\n        renderState.strokeLinecap = 'butt';\n    }\n\n    function processStrokeColour({strokeColour}) {\n        renderState.stroke = getColour(strokeColour);\n    }\n\n    function processStrokeWidth({strokeWidth}) {\n        renderState.strokeWidth = strokeWidth;\n    }\n\n    function processFillColour(data) {\n        renderState.fill = fill(data);\n    }\n\n    function processLineCap({capStyle}) {\n        const styles = [\n            'butt', 'round', 'square', 'butt'\n        ];\n        renderState.strokeLinecap = styles[capStyle];\n    }\n\n    function traverse({children = [], ...data}, reverse) {\n\n        function traverseInner() {\n            if (reverse) {\n                for (const grandchild of children.reverse()) {\n                    traverse(grandchild, false);\n                }\n            } else {\n                for (const grandchild of children) {\n                    traverse(grandchild, true);\n                }\n            }\n        }\n\n        const {type} = data;\n        switch (type & 0xFF) {\n            case RECORD_PATH:\n                traverseInner();\n                processPath(data);\n                break;\n            case RECORD_STROKE_COLOUR:\n                processStrokeColour(data);\n                break;\n            case RECORD_STROKE_WIDTH:\n                processStrokeWidth(data);\n                break;\n            case RECORD_FILL_COLOUR:\n                processFillColour(data);\n                break;\n            case RECORD_LINE_CAP_START:\n                processLineCap(data);\n                break;\n            case RECORD_LINE_CAP_END:\n                processLineCap(data)\n                break;\n            case RECORD_2C:\n                traverseInner();\n                processPath(data);\n                break;\n            case RECORD_34:\n                traverseInner();\n                processPath(data);\n                break;\n            case RECORD_35:\n                traverseInner();\n                processPath(data);\n                break;\n            case RECORD_38:\n                traverseInner();\n                processPath(data);\n                break;\n            case RECORD_3D:\n                traverseInner();\n                processPath(data);\n                break;\n            default:\n                traverseInner();\n                break;\n        }\n    }\n\n    for (const record of records) {\n        traverse(record, true);\n    }\n\n    return {\n        boundingBox: fileBoundingBox,\n        linearGradients,\n        radialGradients,\n        paths\n    };\n}\n\nfunction ShadedComponent({buffer}) {\n    if (!buffer) {\n        return <div/>;\n    }\n\n    const artworks = Artworks.load(buffer);\n    const {error} = artworks;\n    if (error) {\n        return (\n            <div>\n                <div>\n                    A problem occurred loading the file: {error.message}\n                </div>\n            </div>\n        );\n    }\n\n    const {\n        boundingBox: {minX, maxX, minY, maxY},\n        linearGradients,\n        radialGradients,\n        paths\n    } = extractShaded(artworks);\n\n\n    const width = Math.max(maxX - minX, 1);\n    const height = Math.max(maxY - minY, 1);\n\n    const screenWidth = 800;\n    const screenHeight = (height * screenWidth) / width;\n\n    const sx = screenWidth / width;\n    const sy = screenHeight / height;\n\n    const transform = [sx, 0, 0, -sy, -sx * minX, sy * maxY];\n\n    return (\n        <div>\n            <svg width={screenWidth} height={screenHeight}>\n                <defs>\n                    {convertDefs('linearGradient', linearGradients)}\n                    {convertDefs('radialGradient', radialGradients)}\n                </defs>\n                <g transform={`matrix(${transform})`}>\n                    {convertPaths(paths, 160)}\n                </g>\n            </svg>\n        </div>\n    );\n}\n\nexport default ShadedComponent;","import React, {Component} from 'react';\nimport * as d3 from 'd3';\n\nimport {\n    Artworks,\n    RECORD_2C,\n    RECORD_34,\n    RECORD_CHARACTER,\n    RECORD_FILL_COLOUR,\n    RECORD_GROUP,\n    RECORD_LAYER,\n    RECORD_LINE_CAP_END,\n    RECORD_LINE_CAP_START,\n    RECORD_PATH,\n    RECORD_STROKE_COLOUR,\n    RECORD_STROKE_WIDTH,\n} from 'riscos-artworks';\n\nconst FILLS = ['flat', 'linear', 'radial']\n\nfunction nameInner({type, fillType, strokeWidth, strokeColour}) {\n    switch (type & 0xFF) {\n        case RECORD_PATH: return `Path (2)`;\n        case RECORD_GROUP: return 'Group';\n        case RECORD_LAYER: return 'Layer';\n        case RECORD_STROKE_COLOUR: return `Stroke (${strokeColour | 0})`;\n        case RECORD_STROKE_WIDTH: return `Stroke width (${strokeWidth})`;\n        case RECORD_FILL_COLOUR: return `Fill (${FILLS[fillType]})`;\n        case RECORD_LINE_CAP_END: return 'Cap start';\n        case RECORD_LINE_CAP_START: return 'Cap end';\n        case RECORD_2C: return 'Path (2C)';\n        case RECORD_34: return 'Path (34)';\n        case RECORD_CHARACTER: return 'Character';\n        default:\n            return type.toString(16);\n    }\n}\n\nfunction name({type, ...data}) {\n    if (!type) {\n        return 'List';\n    } else {\n        return nameInner({type, ...data});\n    }\n}\n\nclass D3TreeComponent extends Component {\n    constructor(props) {\n        super(props);\n        this.ref = React.createRef();\n    }\n\n    componentDidUpdate() {\n        this.buildTree();\n    }\n\n    componentDidMount() {\n        this.buildTree()\n    }\n\n    buildTree() {\n\n        const {buffer} = this.props;\n        if (!buffer) {\n            return;\n        }\n        const width = 1600;\n\n        const hierarchy = d3.hierarchy({\n            children: Artworks.load(buffer).records\n        });\n        hierarchy.dx = 10;\n        hierarchy.dy = width / (hierarchy.height + 1);\n        const root = d3.tree().nodeSize([hierarchy.dx, hierarchy.dy])(hierarchy);\n\n        let x0 = Infinity;\n        let x1 = -x0;\n        root.each(d => {\n            if (d.x > x1) x1 = d.x;\n            if (d.x < x0) x0 = d.x;\n        });\n\n        this.ref.current.innerHTML = '';\n\n        const svg = d3.select(this.ref.current)\n            .append(\"svg\")\n            .attr(\"viewBox\", [0, 0, width, x1 - x0 + root.dx * 2]);\n\n        const g = svg.append(\"g\")\n            .attr(\"font-family\", \"sans-serif\")\n            .attr(\"font-size\", 10)\n            .attr(\"transform\", `translate(${root.dy / 3},${root.dx - x0})`);\n\n        const link = g.append(\"g\")\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", \"#555\")\n            .attr(\"stroke-opacity\", 0.4)\n            .attr(\"stroke-width\", 1.5)\n            .selectAll(\"path\")\n            .data(root.links())\n            .join(\"path\")\n            .attr(\"d\", d3.linkHorizontal()\n                .x(d => d.y)\n                .y(d => d.x));\n\n        const node = g.append(\"g\")\n            .attr(\"stroke-linejoin\", \"round\")\n            .attr(\"stroke-width\", 3)\n            .selectAll(\"g\")\n            .data(root.descendants())\n            .join(\"g\")\n            .attr(\"transform\", d => `translate(${d.y},${d.x})`);\n\n        node.append(\"circle\")\n            .attr(\"fill\", d => d.children ? \"#555\" : \"#999\")\n            .attr(\"r\", 2.5);\n\n        node.append(\"text\")\n            .attr(\"dy\", \"0.31em\")\n            .attr(\"x\", d => d.children ? -6 : 6)\n            .attr(\"text-anchor\", d => d.children ? \"end\" : \"start\")\n            .text(d => name(d.data))\n            .clone(true).lower()\n            .attr(\"stroke\", \"white\");\n\n    }\n\n    render() {\n        if (!this.props.buffer) {\n            return <div/>;\n        }\n        return <div ref={this.ref}/>;\n    }\n}\n\nexport default D3TreeComponent;","import JSONTree from 'react-json-tree';\nimport {Artworks} from \"riscos-artworks\";\n\nfunction JsonTreeComponent({buffer}) {\n    if (!buffer) {\n        return <div/>;\n    }\n    const artworks = Artworks.load(buffer);\n    return <JSONTree data={artworks} />\n}\n\nexport default JsonTreeComponent;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\n// For Safari:\n// https://gist.github.com/hanayashiki/8dac237671343e7f0b15de617b0051bd\n(function () {\n  File.prototype.arrayBuffer = File.prototype.arrayBuffer || myArrayBuffer;\n  Blob.prototype.arrayBuffer = Blob.prototype.arrayBuffer || myArrayBuffer;\n\n  function myArrayBuffer() {\n    // this: File or Blob\n    return new Promise((resolve) => {\n      let fr = new FileReader();\n      fr.onload = () => {\n        resolve(fr.result);\n      };\n      fr.readAsArrayBuffer(this);\n    })\n  }\n})();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}